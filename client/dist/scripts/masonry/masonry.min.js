import{constants}from"./constants.js";const{METHODS:METHODS,FETCH:FETCH}=constants,masonryJS=({element:t=".masonry",options:e={}})=>{const n=document.querySelector(t);if(!n)return;const o={rows:3,gap:10,timing:300,...e};n.setAttribute("style",`padding: 0 ${o.gap/2}px;`);const s={widthMasonry:n.clientWidth,rowsHeight:Array.from({length:o.rows},(()=>0)),width:Math.floor((n.offsetWidth-o.gap)/o.rows),totalElement:new Map,newElement:new Map},r=()=>{s.rowsHeight=Array.from({length:o.rows},(()=>0))},i=()=>{s.width=Math.floor((n.offsetWidth-o.gap)/o.rows)},a=t=>{if(0!==t.size)for(const[,e]of t){e.querySelector("img").style.display||e.querySelector("img").setAttribute("style","display: block; width: 100%; height: auto;"),e.setAttribute("style",`position: absolute; \n                top: 0; \n                left: ${o.gap/2}px; \n                width: ${s.width}px; \n                padding: 0 ${o.gap/2}px; \n                box-sizing: border-box;`);const t=e.offsetHeight,r=s.rowsHeight.indexOf(Math.min(...s.rowsHeight))<0?0:s.rowsHeight.indexOf(Math.min(...s.rowsHeight));e.style.transform=`translate(${s.width*r}px, ${Number(s.rowsHeight[r])+o.gap}px)`,e.classList.remove("isNew"),s.rowsHeight[r]=s.rowsHeight[r]+t+o.gap,n.dataset.arr=s.rowsHeight.join(" "),s.newElement.has(e)&&s.newElement.delete(e)}},l=()=>{(()=>{const t=n.querySelectorAll(".img-wrap.isNew"),e=t.length;for(let n=0;n<e;n++)s.totalElement.has(t[n])||(s.totalElement.set(t[n],t[n]),s.newElement.set(t[n],t[n]))})(),i(),a(s.newElement)};r();return METHODS.RO((()=>{const t=n.clientWidth,e=t!==s.widthMasonry;e&&(r(),i()),a(e?s.totalElement:s.newElement),s.widthMasonry=t}),10).observe(document.querySelector("body")),()=>{l()}},prototype=(()=>{"use strict";let t=0;const e=document.querySelector(".masonry"),n=document.querySelector(".infiniteScroll"),o=(t=!1)=>{document.getElementById("loader").style.display=t?"flex":"none"},s=(t=!1)=>{n.classList[t?"add":"remove"]("disconnect"),t&&(()=>{const t=e.dataset.arr.split(" ")??[],o=Math.max(...t);n.style.transform=`translateY(${o<0?window.innerHeight+10:o-10}px)`})()},r=masonryJS({element:".masonry",options:{rows:3}}),i=async t=>{((t=[])=>{if(o(!0),!r)return;if(!e)return;if(0===t.length)return;const n=t.reduce(((t,e)=>[...t,`<div class="img-wrap isNew">\n                    <img src="${e.download_url}" width="${e.width}" height="${e.height}" alt="${e.author}">\n                </div>`]),[]);e.insertAdjacentHTML("beforeend",n.join("")),o()})(t),r(),s(!0)},a=()=>{if(n.classList.contains("disconnect"))return s();(async()=>{const e=await(async()=>(t++,await FETCH.GET(`https://picsum.photos/v2/list?page=${t}&limit=20`)))();e&&await i(e)})()};return{init:()=>{METHODS.IO(a).observe(n)}}})();"complete"===document.readyState?prototype.init():document.addEventListener&&document.addEventListener("DOMContentLoaded",prototype.init);